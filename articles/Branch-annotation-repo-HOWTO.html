<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to branch the Annotation package repository • ReleaseLaunch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to branch the Annotation package repository">
<meta property="og:description" content="ReleaseLaunch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ReleaseLaunch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ReleaseChecklist.html">The Release Checklist</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    How-Tos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Branch-annotation-repo-HOWTO.html">Branch annotation package repository</a>
    </li>
    <li>
      <a href="../articles/Flush-Packages-HOWTO.html">Flush packages</a>
    </li>
    <li>
      <a href="../articles/Version-bump-and-branch-creation-HOWTO.html">Version bump and branch</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Bioconductor/ReleaseLaunch">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to branch the Annotation package
repository</h1>
                        <h4 data-toc-skip class="author">Bioconductor
Maintainer</h4>
            
            <h4 data-toc-skip class="date">January 28, 2023</h4>
      
      
      <div class="hidden name"><code>Branch-annotation-repo-HOWTO.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.infobox {
  padding: 1em 1em 1em 1em;
  margin-bottom: 10px;
  border: 2px solid #008000;
  border-radius: 10px;
  background: #c7dbe4 5px center/3em no-repeat;
  color: #8B0000;
}

.center {
  text-align: center;
}
</style>
<div class="section level2">
<h2 id="branching-annotation">Branching Annotation<a class="anchor" aria-label="anchor" href="#branching-annotation"></a>
</h2>
<p>The document describes how to branch the annotation repository for a
new release. This can be done the day of the release or several days
after.</p>
<p>Before branching, Check and make sure there is enough room on master
for the annotations. If there isn’t enough room follow the guidelines
for moving old <a href="https://github.com/Bioconductor/AWS_management/blob/master/docs/S3_website.md" class="external-link">Bioconductor
releases into S3</a> As of release 3.13 Annotations are around 113G.</p>
<p>These instructions use BioC 3.14 as the new devel version and
nebbiolo2 as the devel master builder.</p>
<p>As of 3.14, the linux builders have moved to DFCI in Boston. Personal
accounts and the jump account should be set up for access.</p>
<div class="section level3">
<h3 id="set-up-nebbiolo2">Set up nebbiolo2<a class="anchor" aria-label="anchor" href="#set-up-nebbiolo2"></a>
</h3>
<div class="section level4">
<h4 id="create-new-annotation-repo-on-devel-master-builder-nebbiolo2">Create new annotation repo on devel master builder (nebbiolo2)<a class="anchor" aria-label="anchor" href="#create-new-annotation-repo-on-devel-master-builder-nebbiolo2"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> to nebbiolo2 as biocpush user</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/PACKAGES/3.14/data</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> annotation</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rsync-annotations-from-current-release">rsync annotations from current release<a class="anchor" aria-label="anchor" href="#rsync-annotations-from-current-release"></a>
</h4>
<p>Because 3.13 used RPCI mablec2 and 3.14 used DFCI nebbiolo2, we could
only rsync in one direction because of firewalls. It should work on
either machine, in either direction in the future if under the same
firewall.</p>
<div class="infobox">
<p><strong>Notes</strong></p>
<ul>
<li>Run with <code>--dry-run</code> first</li>
<li>Note the trailing slash <code>/</code> and dot <code>.</code>
</li>
</ul>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From malbec2 to nebbiolo2 (logged into malbec2):</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/PACKAGES/3.13/data/annotation</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">--dry-run</span> <span class="at">-ave</span> ssh . biocpush@nebbiolo2:PACKAGES/3.14/data/annotation/</span></code></pre></div>
<p>Live Run if all looks correct</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-ave</span> ssh . biocpush@nebbiolo2:PACKAGES/3.14/data/annotation/</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remove-symlinks-for-old-r-versions-for-windows-and-mac">Remove symlinks for old R versions for windows and mac<a class="anchor" aria-label="anchor" href="#remove-symlinks-for-old-r-versions-for-windows-and-mac"></a>
</h4>
<p>There may be symlinks in the windows and macosx folders. These will
only be present when the new version of BioC uses a new version of R
which happens every other version of BioC. If they are present, they
will look something like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/PACKAGES/3.7/data/annotation/bin/windows/contrib/3.5</span> <span class="at">-</span><span class="op">&gt;</span> 3.4</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/PACKAGES/3.7/data/annotation/bin/macosx/contrib/3.5</span> <span class="at">-</span><span class="op">&gt;</span> 3.4</span></code></pre></div>
<p>Remove the symlinks and rename the folder with content to the version
of R being used by devel e.g.,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> ~/PACKAGES/3.7/data/annotation/bin/windows/contrib/3.5 <span class="at">-</span><span class="op">&gt;</span> 3.4</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> 3.4 3.5</span></code></pre></div>
<p>The PACKAGES and PACKAGES.gz files are empty. They are needed for
install.packages() even though we don’t have binaries for
annotations.</p>
<p>A rerun of the <code>rsync</code> command should only show changes in
the files we just edited:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">--dry-run</span> <span class="at">-ave</span> ssh</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[biocadmin\@malbec1]</span><span class="er">(</span><span class="ex">mailto:biocadmin@malbec1</span><span class="kw">)</span><span class="ex">{.email}:PACKAGES/3.6/data/annotation/</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="set-up-master-bioconductor-org">Set up &lt;master.bioconductor.org&gt;<a class="anchor" aria-label="anchor" href="#set-up-master-bioconductor-org"></a>
</h3>
<div class="section level4">
<h4 id="log-on-master-as-webadmin">Log on master as webadmin<a class="anchor" aria-label="anchor" href="#log-on-master-as-webadmin"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[ubuntu\@master.biocondcutor.org]</span><span class="er">(</span><span class="ex">mailto:ubuntu@master.biocondcutor.org</span><span class="kw">)</span><span class="ex">{.email}</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> su <span class="at">-</span> webadmin cd /extra/www/bioc/packages/3.14/data/annotation</span></code></pre></div>
<p>Products are sent to master from both nebbiolo2 and
staging.bioconductor.org. Because of this, the rsync from nebbiolo2 to
master is not from the top level; we want to leave the products
deposited by staging.bioconductor.org untouched.</p>
</div>
<div class="section level4">
<h4 id="remove-symlink-and-create-empty-annotation-folder">Remove symlink and create empty annotation folder<a class="anchor" aria-label="anchor" href="#remove-symlink-and-create-empty-annotation-folder"></a>
</h4>
<p>There will likely be a simlink at</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/extra/www/bioc/packages/3.14/data/annotation</span> <span class="at">-</span><span class="op">&gt;</span> ../../3.13/data/annotation</span></code></pre></div>
<p>pointing to the current release annotation repo. In recent years, the
symlinks have appeared underneath an already created annotation
repostiory. The point is to start with a non-linked empty annotation
folder. Remove annotation and recreate:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> annotation</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="create-a-new-annotation-folder">Create a new annotation folder<a class="anchor" aria-label="anchor" href="#create-a-new-annotation-folder"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> annotation</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="back-to-nebbiolo2-to-run-the-propagation-scripts">Back to nebbiolo2 to run the propagation scripts<a class="anchor" aria-label="anchor" href="#back-to-nebbiolo2-to-run-the-propagation-scripts"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Remove any deprecated packages from the 3.13 annotation repo that
should not be included in the devel 3.14 repo.</p></li>
<li><p>Update and run cronjob by hand (should be commented
out).</p></li>
</ol>
<div class="infobox">
<p>Symlink must be gone on master before running this!!</p>
</div>
<p>Run the crontab entry by hand. Monitor
~/cron.log/3.14/propagate-data-annotation-* log file.</p>
<ol start="3" style="list-style-type: decimal">
<li>Test BiocManager::install() to see if it finds the new repo. Try
installing a package that should be found and try installing a removed
package that should fail.</li>
</ol>
</div>
<div class="section level3">
<h3 id="update-bioconductor-orgconfig-yaml-to-build-landing-pages-for-3-14">Update bioconductor.org/config.yaml to build landing pages for
3.14<a class="anchor" aria-label="anchor" href="#update-bioconductor-orgconfig-yaml-to-build-landing-pages-for-3-14"></a>
</h3>
<p>Uncomment ‘data/annotation’:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">devel_repos</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="st">"bioc"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="st">"data/experiment"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="st">"data/annotation"</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marcel Ramos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
